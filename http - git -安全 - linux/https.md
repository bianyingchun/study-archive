### HTTP 风险

1. 通信使用**明文**（不加密），内容可能会被**窃听**
2. 不验证通信方身份，可能遭遇**伪装**
3. 无法**验证报文完整性**，可能遭遇**篡改**

### HTTPS

HTTPS 指的是超文本传输安全协议，HTTPS 是基于 HTTP 协议的，不过它会使用 TLS/SSL 来对数据加密。使用 TLS/ SSL 协议，所有的信息都是加密的，第三方没有办法窃听。并且它提供了一种校验机制，信息一旦被篡改，通信的双方会立刻发现。它还配备了身份证书，防止身份被冒充的情况出现。
HTTPS = HTTP + SSL（安全套接层）/TLS(安全传输协议 Transport Layer Security)
HTTPS = HTTP +加密+认证+完整性保护
>SSL 因为应用广泛，已经成为互联网上的事实标准。IETF 就在那年把 SSL 标准化。标准化之后的名称改为 TLS,很多相关的文章都把这两者并列称呼（SSL/TLS），因为这两者可以视作同一个东西的不同阶段
### SSL/TLS 协议运行机制

#### 对称加密算法

比如 AES
双方使用同一个秘钥对数据进行加 密和解密。但是对称加密的存在一个问题，就 是如何保证秘钥传输的安全性， 因为秘钥还是会通过网络传输的，一旦秘钥被其他人获取到，那么整个加密过程就毫无作用了。 这就要用到非对称加密的方法。

#### 非对称加密算法

比如 RSA
有两个秘钥，一个是公钥，一个是私钥。公钥是公开的，私钥是保密的。用私钥加密的数据，只有对应的公钥才能解密，用公钥加密的数据，只有对应的私钥才能解密。我们可以将公钥公布出去，任何想和我们通信的客户， 都可以使用我们提供的公钥对数据进行加密，这样我们就可以使用私钥进行解密，这样就能保证数据的安全了。

#### HTTPS 采用混合加密方法

对称加密算法：速度快，安全性差
非对称加密算法：速度慢，安全性高
HTTPS：**交换密钥**阶段采用**非对称密钥加密**方法，之后建立通信**交换报文**阶段采用**对称密钥加密**方法

### 如何确定公开密钥的安全性

单纯的对称+非对称加密算法也不一定是安全的。因为我们没有办法确定我们得到的公钥就一定是安全的公钥。可能存在一个**中间人**，截取了对方发给我们的公钥，然后将他自己的公钥发送给我们，当我们使用他的公钥加密后发送的信息，就可以被他用自己的私钥解密。然后他伪装成我们以同样的方法向对方发送信息，这样我们的信息就被窃取了，然而我们自己还不知道。

##### 数字证书

为了解决这样的问题，我们可以使用数字证书的方式。

1. 首先我们使用一种 **Hash 算法**来对**我们的公钥**和其他信息（原始信息 P）进行加密生成一个**信息摘要**
2. 然后让有公信力的认证中心（简称 CA ）用**它的私钥**对消息摘要加密，形成**签名（S）**。
3. 最后将**原始信息和签名（P,S）**合在一起，称为**数字证书**。
4. 认证数字证书
   当接收方收到数字证书的时候
   - 先根据原始信息（P）使用同样的 Hash 算法生成一个摘要
   - 然后使用公证处的公钥来对数字证书中的签名（S）进行解密得到摘要
   - 最后将解密的摘要和我们生成的摘要进行对比，就能发现我们得到的信息是否被更改了。

这个方法最重要的是**认证中心的可靠性**， 一般浏览器里会内置一些顶层的认证中心的证书，相当于我们自动信任了他们， 只有这样我们才能保证数据的安全。

详情可参考知乎上的这个回答:[数字证书的原理是什么？](https://www.zhihu.com/question/24294477/answer/74783418)

### SSL/TLS 协议基本过程

1. 客户端向服务器端索要并验证公钥。

2. 双方协商生成"对话密钥"。

3. 双方采用"对话密钥"进行加密通信。

上面过程的前两步，又称为"握手阶段"（handshake）。

#### 握手阶段

握手阶段"的所有通信都是明文的。

1. 客户端向服务器发起请求
   请求中包含：

- 使用的协议版本号
- 生成的一个**随机数**（用于生成对话秘钥）
- 客户端支持的加密方法
- 客户端支持的压缩算法

2. 服务器端接收到请求后发出响应
   响应中包含：

- 确认双方使用的加密方法
- 服务器的证书
- 一个服务器生成的**随机数**。

3. 客户端回应

- 客户端确认服务器证书有效后，生成一个新的**随机数**，
- 并使用数字证书中的公钥，加密这个随机数，然后发给服务器
- 并且还会提供一个前面所有内容的 hash 的值，用来供服务器检验。表示客户端的握手阶段已经结束。

4. 服务器响应

- 服务器使用自己的私钥，来解密客户端发送过来的随机数。
- 并提供前面所有内容的 hash 值来供客户端检验。表示服务器的握手阶段已经结束。

5. 生成对话秘钥
   客户端和服务器端根据约定的加密方法使用前面的三个随机数，生成对话秘钥，以后的对话过程都使用这个秘钥来加密信息。

### 为什么不一直使用 HTTPS

1. 加密通信消耗更多内存和 CPU
2. 节约购买证书的成本
3. 敏感信息才使用 HTTPS

### 参考文章

1. [SSL/TLS 协议运行机制的概述](http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html)
2. [HTTPS 原理分析——带着疑问层层深入](https://blog.leapmie.com/archives)
3. [数字签名和数字证书究竟是什么？](jianshu.com/p/80aa37311151)
