混剪视频分镜方案讨论和初步实现：
1、将模板视频合成层进行分组
2、按照传入的数据，处理每组的合成层，替换文本等属性，设置 startTime, inPoint,outPoint（startTime<=intPoint,startTime 未视频素材在项目中的开始位置，inPoint 为播放开始位置）.每组的最大 outPoint 将作为下一组的初始位置
3、将每组的合成层转为预合成，并删除项目中的所有非预合成层，设置新的 workAreaDuration

1、混剪视频：
1、根据传入的视频长度动态缩短或延长尾帧长度，并设置合成的 workDuration，和 duration，注意设置 duration 时会影响 workDuration，先用临时变量保存原 workDuration，再基于偏移设置新值
2、修改主视频缩短，其他 layer 的位置变动逻辑：统一根据偏移值向左移动，最小 inpoint 设为 0

1. 验证转场预设动效、文字动效可用性
2. ws 失败重连
3. 排查创建批量任务时执行失败原因

1、模板替换支持含预合成的模板
2、修复任务卡住导致后续内容无法执行，增加超时处理：重启 ae 和 node 进程

1、解决部分 mp3 文件导入 ae 中变调失真问题，将 mp3 文件转为 wav 格式
2、模板文件信息读取

修复 ae 执行异常导致后续任务无法执行：
1、使用 noui，不打开 ae 界面：应用文本动画执行超时，导致无法生成 jsx 脚本，需打开界面。
2、在 ae 执行结束（成功/失败）后，使用 app.project.close()关闭项目，防止阻塞后续项目创建和打开

、文本层支持 background 属性，自动根据文本内容高度和内边距绘制背景图形层。
2、对含图形变换的转场动效，支持图形填充色自定义
3、调整客户提供的模板，并对合成中含预合成的图层递归遍历替换

1、整体测试动画转场，查缺补漏，整理弹性动画列表
2、整理预设目录并移动至系统用户文件夹
3、处理字段 size，计算并设置图片视频图层缩放比

1. 排查部分 MP3 文件导入 ae 中变速和变调问题：ae 版本问题，需将 ae 升级到 2021
2. 升级 ae

1、应用花字样式
2、文本固定宽度，高度根据内容自适应：
创建一个足够大的盒文本层辅助计算实际内容高度，再以此高度去创建文本盒子
3、兼容老版本坐标系（左上角）
4、调试转场和文本动画

1、统一坐标系为图层中心点（锚点，位置）
1、将位置、旋转、缩放此类变换操作封装为公共函数 setTransform
2、修改含多文本块的文本绘制策略：基于文本盒子大小新建合成，从左上角位置开始绘制文本，将合成作为层添加到主合成，调用 setTransform 统一设置位置等属性
2、ae 通过设置图层样式实现花字：描边、阴影、渐变、发光

1、重构代码，将动画分为关键帧动画和弹性表达式动画，不存储预处理数据。
2、文本动画设置缓动，缓入 ，缓出
3、弹性动画增加 freq , decay , duration 参数设置

1、实现文字动画
2、混剪 v2.3 需求评审
3、调研 ae 艺术字实现:双层描边、阴影、渐变

1、分析并实现关键帧文本动画
2、分析弹性表达式，调节参数（freq,decay,duration,offset)控制动画,以根据动画总时长生成动态参数，实现部分弹性动画

1、整理文字动画，实现出场动画，封装处理多层嵌套动画帧
2、学习 ae 动画表达式，以修改部分表达式实现的文字动画

脚本实现 ae 文本动画：
1、读取各文本动画属性数据，根据配置修改属性数据后回写：动画工具下的属性选择器无法设置值，方案不可行
2、将文本动画保存为预设文件，调用 layer.applyPreset 应用预设，根据配置（动画开始时间，动画时长）修改动画关键帧时间点

1、定义转场动画数据结构（新增 type 为 transition）
2、打开带有转场预设的基础 aep 项目，基于配置为合成添加转场动画：复制预设的预合成，配置宽高、持续时间以及转场点

1、修改高斯模糊模板，将背景图片替换为文字层，导出模板时需将资源路径替换为占位符，否则资源在服务器上出现路径失效问题
2、解决 After Effects 错误: 不支持源压缩类型、渲染超时：将资源 oss 路径替换为 cdn 路径
3、修复 ws 心跳失效：监听到 ping 时间，立即 send("png"),非延时发送

1、定义转场动画数据结构（新增 type 为 transition）
2、打开带有转场预设的基础 aep 项目，基于配置为合成添加转场动画：复制预设的预合成，配置宽高、持续时间以及转场点

1、修改高斯模糊模板，将背景图片替换为文字层，导出模板时需将资源路径替换为占位符，否则资源在服务器上出现路径失效问题
2、解决 After Effects 错误: 不支持源压缩类型、渲染超时：将资源 oss 路径替换为 cdn 路径
3、修复 ws 心跳失效：监听到 ping 时间，立即 send("png"),非延时发送

1、分析特效属性设置，为可设置 keyframe 的属性设置 keyframe
2、测试环境运行分镜任务
1、音量设置报未知错误、待解决
2、设置工作时长因小数问题报错：先设置总时长、再获取总时长的值赋给工作时长
3、不开启 AE UI 下生成策略报错

> > ---
## 混剪视频
技术架构：前端(Vue3+TS), 后端（Golang）,视频生成引擎（NodeJs+AE Script+Ffmpeg）
项目介绍：该项目旨在提供高效的在线智能批量广告视频生成和编辑服务，实现了批量模板视频替换、分镜视频生成、在线视频剪辑这三种主要服务。我主要负责视频生成引擎的调研及开发工作，以及部分前端页面的编写。
1. 引入库after-effects,实现在NodeJS中编写 AE脚本，调用AE.exe生成aep项目，根据不同的配置，替换或生成视频。除了提供基础的文案、图片、音视频图层的组合生成，还实现了花字、转场动画、文字动效等复杂效果。
2. 根据模板文件，替换文案、图片、视频等元素，并自动根据替换后的资源时长，调节动画时长、处理图片视频缩放，动态调整图层位置，从而批量生成符合原模板效果的视频。
3. 解决了ae中文本层不支持内联样式、不能根据文本内容自适应高度、ae程序执行异常导致后续任务无法执行等问题。
4. 调用aerender.exe，添加合成到渲染队列生成avi，通过转码工具ffmepg转为最终生成的mp4文件。
5. 使用 websocket 与任务调度中心通信，作为消费端处理推送来的任务，完成并上报任务，为保障长连接通信，增加了心跳包机制，连接失败和断开时自动重连。
6. 通过进程守护框架 pm2 启动项目，在抛出错误时自动重启服务。


## 报表模板编辑器 
技术架构：React+XspredSheet.js+Draft.js
项目介绍：将原来数据团队手动为客户配置数据报表的工作的智能化，为智投的客户提供在线报表模板编辑器，提供了数十种常用报表模板，并支持自定义模板。类execl的配置，减少了客户的学习成本，支持聚合函数、算数表达式，汇总行自动填充等功能，极大的增加了报表的配置灵活度。
1. 实现 react 封装 xSpreadSheet 插件。
2. 结合业务场景，阅读并修改xSpreadSheet源码，扩展插件功能。例如绘制单元格角标，显示标注面板、增加自定义事件监听、禁用编辑。
3. 结合富文本编辑器DraftJs复写表格输入编辑器实现点击数据字段填充和插入表达式。自定义 draftJS 实体类型，实现插入字段到光标位置，以支持字段作为变量高亮显示且不可分割。自动校验表达式合法性，序列化和反序列化数据
4. 结合账户列表自动生成标题行，数据行，合计行。并支持外部xlsx文件的数据导入。
5. 实现分步骤编辑数据缓存，且支持在多页面可同时编辑或创建模板，缓存数据

