## webpack 中的热更新原理

1. 对本地源文件内容变更的监控
2. 网页和本地服务器的 websocket 通信
3. 模块解析和替换功能

## webpack 中的打包流程

在讲 webpack 的打包流程之前我们先解释几个 webpack 中的术语：

- module：指在模块化编程中我们把应用程序分割成的独立功能的代码模块。
- chunk：指模块间按照引用关系组合成的代码块，一个 chunk 中可以包含多个 module。
- chunk group：指通过配置入口点（entry point）区分的块组，一个 chunk group 中可包含一到多个 chunk。
- bundling：webpack 打包的过程。
- asset/bundle：打包产物。

#### webpack 的打包思想可以简化为 3 点：

1. 一切源代码文件均可通过各种 Loader 转换为 JS 模块 （module），模块之间可以互相引用。

2. webpack 通过入口点（entry point）递归处理各模块引用关系，最后输出为一个或多个产物包 js(bundle) 文件。

3. 每一个入口点都是一个块组（chunk group），在不考虑分包的情况下，一个 chunk group 中只有一个 chunk，该 chunk 包含递归分析后的所有模块。每一个 chunk 都有对应的一个打包后的输出文件（asset/bundle）。

### 基本流程

从 entry 中的 './src/index1.js' 到打包产物的 dist/main.js，以模块的角度而言，其基本流程是：

1. 唯一 entry 创建一个块组（chunk group）， name 为 main，包含了 ./src/index1.js 这一个模块。

2. 在解析器中处理 ./src/index1.js 模块的代码，找到了其依赖的 './style.css'，找到匹配的 loader: css-loader 和 style-loader。
3. 首先通过 css-loader 处理，将 css-loader/dist/cjs.js!./src/style.css 模块（即把 CSS 文件内容转化为 js 可执行代码的模块，这里简称为 Content 模块）和 css-loader/dist/runtime/api.js 模块打入 chunk 中。

4. 然后通过 style-loader 处理，将 style-loader/dist/runtime/injectStylesIntoStyleTag.js 模块 （我们这里简称为 API 模块），以及处理后的 .src/style.css 模块（作用是运行时中通过 API 模块将 Content 模块内容注入 Style 标签）导入 chunk 中。

5. 依次类推，直到将所有依赖的模块均打入到 chunk 中，最后输出名为 main.js 的产物（我们称为 Asset 或 Bundle）。
