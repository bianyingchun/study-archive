## 词法环境与变量环境组件

1. 词法环境
   LexicalEnvironment 标识用于解析代码在此执行上下文中进行的标识符引用的词汇环境。
2. 变量环境
   VariableEnvironment 标识词汇环境，其 EnvironmentRecord 保存在此执行上下文中由 VariableStatements 创建的绑定。

执行上下文的 LexicalEnvironment 和 VariableEnvironment 组件始终是词汇环境 LexicalEnvironment。创建执行上下文时，它的 LexicalEnvironment 和 VariableEnvironment 组件最初具有相同的值。

## 词法环境

词法环境是一种规范类型，用于根据 ECMAScript 代码的词法嵌套结构定义标识符与特定变量和函数的关联。词法环境由**环境记录 environment record 和对外部词法环境 outer 的可能空引用组成**。

通常，词法环境与 ECMAScript 代码的某些特定语法结构相关联，例如 FunctionDeclaration、BlockStatement 或 TryStatement 的 Catch 子句，并且每次对这些代码求值时都会创建一个新的词法环境。

### environment record

环境记录记录在其关联词汇环境的范围内创建的标识符绑定。它被称为词汇环境的 EnvironmentRecord

### outer

1. 指向父词法环境
2. 全局环境的外部环境引用为空

### 全局环境

全局环境的外部环境引用为空。
全局环境的 EnvironmentRecord 可以预先填充标识符绑定，并包括一个关联的**全局对象**，其属性提供了一些全局环境的标识符绑定。此全局对象是全局环境的此绑定的值。在执行 ECMAScript 代码时，可以向全局对象添加其他属性，并修改初始属性。

### 模块环境

模块环境是一个词汇环境，包含模块顶级声明的绑定。它还包含由模块显式导入的绑定。
模块环境的外部环境是一个全局环境。

### 函数环境

函数环境是对应于 ECMAScript 函数对象调用的词汇环境。函数环境可能会为此绑定建立一个新的函数。函数环境还捕获支持超级方法调用所需的状态。

### 环境记录

本规范中使用了两种主要的环境记录值：声明性环境记录和对象环境记录。

- 声明性环境记录
  用于定义 ECMAScript 语言语法元素的效果，如 FunctionDeclarations、VariableDeclarations 和 Catch 子句，它们直接将标识符绑定与 ECMAScript 语言值关联。
- 对象环境记录
  用于定义 ECMAScript 元素的效果，例如将标识符绑定与某些对象的属性相关联的 WithStatement。

* 全局环境记录和函数环境记录是专门用于脚本全局声明和函数内顶级声明的专用化。

出于规范目的，环境记录值是记录规范类型的值，可以认为存在于简单的面向对象层次结构中，其中环境记录是一个抽象类，包含三个具体的子类：

- 声明性环境记录
  - 函数环境记录
  - 模块环境记录
    是声明性环境记录的子类。
- 对象环境记录
- 全局环境记录。

#### 声明性环境记录

每个声明性环境记录都与包含变量、常量、let、类、模块、导入和/或函数声明的 ECMAScript 程序范围相关联。声明性环境记录绑定由其范围内包含的声明定义的标识符集。

##### 函数式环境记录

函数环境记录是一种声明性环境记录，用于表示函数的顶级作用域，如果函数不是箭头函数，则提供此绑定的声明性环境记录 thisBinding。

##### 模块式环境记录

#### 对象环境记录

每个对象环境记录都与一个名为其绑定对象的对象 binding object 相关联。对象环境记录绑定与其绑定对象的属性名称直接对应的字符串标识符名称集。属性可以从对象中动态添加和删除

为 with 语句创建的对象环境记录可以将其绑定对象作为隐式值提供给函数调用。该功能由与每个对象环境记录关联的 withEnvironment 布尔值控制。默认情况下，任何对象环境记录的 withEnvironment 值都为 false。

#### 全局环境记录

全局环境记录在逻辑上是单个记录，但它被指定为封装对象环境记录和声明性环境记录的复合记录

- 对象环境记录的基础对象是关联领域的**全局对象**。此全局对象是全局环境记录的 GetThisBinding 具体方法返回的值。全局环境记录的对象环境记录组件包含所有内置全局属性，以及全局代码中包含的 FunctionDeclaration、GeneratorDeclaration 或 VariableStatement 引入的所有绑定。
- 全局代码中所有其他 ECMAScript 声明的绑定都包含在全局环境记录的声明性环境记录组件中。let、const、class...

https://juejin.cn/post/6844903733495595016
