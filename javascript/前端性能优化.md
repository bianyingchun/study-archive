### 前言

什么样的网页对于用户体验是好的？无非是更快速的加载，更高效的执行，本文我将从加载和执行这两个方面来讨论前端优化。

### 加载优化

加载过程是最为耗时的过程，可能会占到总耗时的`80%时间(**优化重点**)

##### 1.减少 HTTP 请求

尽量减少页面的请求数

- 合并 CSS 和 JS
- 使用 CSS 精灵图

##### 2.缓存资源

使用缓存可减少向服务器的请求数，节省加载时间，所有静态资源都要在服务器端设置缓存，并且尽量使用长缓存(使用时间戳更新缓存)

- 缓存一切可缓存的资源
- 使用长缓存
- 使用外联的样式和脚本

##### 3. 压缩代码

减少资源大小可加快网页显示速度，对代码进行压缩，并在服务器端设置 GZip

- 压缩代码(多余的缩进、空格和换行符)
- 启用 Gzip

##### 4. 无阻塞

头部内联的样式和脚本会阻塞页面的渲染，样式放在头部并使用 link 方式引入，脚本放在尾部并使用异步方式加载

##### 5. 首屏加载

首屏快速显示可大大提升用户对页面速度的感知，应尽量针对首屏的快速显示做优化

##### 6. 按需加载

将不影响首屏的资源和当前屏幕不用的资源放到用户需要时才加载，可大大提升显示速度和降低总体流量(按需加载会导致大量重绘，影响渲染性能)

- 懒加载
- 滚屏加载
- Media Query 加载

##### 7.预加载：大型资源页面可使用 Loading，资源加载完成后再显示页面，但加载时间过长，会造成用户流失

- 可感知 Loading：进入页面时 Loading
- 不可感知 Loading：提前加载下一页

#### 8. 压缩图像

使用图像时选择最合适的格式和大小，然后使用工具压缩，同时在代码中用 srcset 来按需显示(过度压缩图像大小影响图像显示效果)

- 使用 TinyJpg 和 TinyPng 压缩图像
- 使用 CSS3、SVG、IconFont 代替图像
- 使用 img 的 srcset 按需加载图像
- 选择合适的图像：webp 优于 jpg，png8 优于 gif
- 选择合适的大小：首次加载不大于 1014kb、不宽于 640px

##### 9. 减少 Cookie

Cookie 会影响加载速度，静态资源域名不使用 Cookie

##### 10. 避免重定向

重定向会影响加载速度，在服务器正确设置避免重定向

##### 11. 异步加载第三方资源

第三方资源不可控会影响页面的加载和显示，要异步加载第三方资源

### 执行优化

CSS 写在头部，JS 写在尾部并异步
避免 img、iframe 等的 src 为空：空 src 会重新加载当前页面，影响速度和效率
尽量避免重置图像大小：多次重置图像大小会引发图像的多次重绘，影响性能
图像尽量避免使用 DataURL：DataURL 图像没有使用图像的压缩算法，文件会变大，并且要解码后再渲染，加载慢耗时长
执行处理不当会阻塞页面加载和渲染

### 渲染优化

设置 viewport：HTML 的 viewport 可加速页面的渲染
html <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1">
减少 DOM 节点：DOM 节点太多影响页面的渲染，尽量减少 DOM 节点

### 优化动画

- 尽量使用 CSS3 动画
- 合理使用 requestAnimationFrame 动画代替 setTimeout
- 适当使用 Canvas 动画：5 个元素以内使用 CSS 动画，5 个元素以上使用 Canvas 动画，iOS8+可使用 WebGL 动画

### 优化高频事件：scroll、touchmove 等事件可导致多次渲染

- 函数节流
- 函数防抖
- 使用 requestAnimationFrame 监听帧变化：使得在正确的时间进行渲染
  增加响应变化的时间间隔：减少重绘次数
  GPU 加速：使用某些 HTML5 标签和 CSS3 属性会触发 GPU 渲染，请合理使用(过渡使用会引发手机耗电量增加)
  HTML 标签：video、canvas、webgl
  CSS 属性：opacity、transform、transition
  样式优化
  避免在 HTML 中书写 style
  避免 CSS 表达式：CSS 表达式的执行需跳出 CSS 树的渲染
  移除 CSS 空规则：CSS 空规则增加了 css 文件的大小，影响 CSS 树的执行

### 正确使用 display

display 会影响页面的渲染
display:inline 后不应该再使用 float、margin、padding、width 和 height
display:inline-block 后不应该再使用 float
display:block 后不应该再使用 vertical-align
display:table-\*后不应该再使用 float 和 margin

//https://www.cnblogs.com/xiaohuochai/p/9178390.html
//https://segmentfault.com/a/1190000022205291
//https://zhuanlan.zhihu.com/p/88384957
